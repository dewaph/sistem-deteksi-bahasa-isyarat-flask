{% extends 'layouts/base.html' %} {% block title %} Terjemahan {% endblock title
%}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<style>
  .rectangle {
    width: 100%;
    height: 27.5px;
    background-color: #5e72e4;
    position: absolute;
    bottom: 0;
    left: 0;
    z-index: 0;
  }
</style>
{% endblock stylesheets %} {% block content %}

<div
  class="position-absolute w-100 min-height-300 top-0"
  style="background-image: url('{{ config.ASSETS_ROOT }}/img/profile-layout-header.jpg'); background-position-y: 50%;"
>
  <span class="mask bg-primary opacity-6"></span>
</div>

{% include "includes/sidenav.html" %}

<main class="main-content position-relative border-radius-lg">
  {% include "includes/navigation.html" %}
  <div class="container-fluid py-4 align-items-center flex-column">
    <!-- Apply d-flex, justify-content-center, align-items-center, and flex-column classes -->
    <div class="row">
      <div class="col-12">
        <div class="card mb-4 text-center">
          <h1>Penerjemah Bahasa Isyarat Tangan BISINDO</h1>
          <div
            id="videoContainer"
            class="d-flex justify-content-center align-items-start"
          >
            <img
              id="videoStream"
              src=""
              width="60%"
              style="
                display: none;
                margin-right: 20px;
                outline: 2px solid #5e72e4;
                border-radius: 8px;
                box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
              "
            />
            <div
              class="transcript"
              style="
                width: 35%;
                height: 24%;
                align-self: flex-start;
                outline: 2px solid #5e72e4;
                border-radius: 8px;
                box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
              "
            >
              <div
                class="header"
                style="margin-bottom: 20px; position: relative"
              >
                <h5 style="position: relative; z-index: 1; color: white">
                  Mulai Menerjemahkan
                </h5>
                <div class="rectangle"></div>
              </div>
              <p>Transkrip:</p>
              <div
                id="transcript_div"
                style="
                  width: 95%;
                  outline: 1px solid #5e72e4;
                  border-radius: 8px;
                  box-shadow: black;
                  min-height: 26px;
                  margin: auto;
                "
              ></div>
              <br />
              <button id="delete_btn" class="btn btn-danger">Hapus</button>
              <button id="add_space_btn" class="btn btn-secondary">
                Tambah Spasi
              </button>
              <div
                id="message"
                role="alert"
                style="display: none"
                class="alert"
              >
                Menambahkan Spasi!
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
<script>
  const transcriptDiv = document.getElementById("transcript_div");
  const messageDiv = document.getElementById("message");

  function updateRecognizedCharacters() {
    fetch("/recognized_characters")
      .then((response) => response.json())
      .then((data) => {
        transcriptDiv.innerHTML = data.recognized_characters;
      })
      .catch((error) => console.error("Error:", error));
  }

  function removeLastCharacter() {
    fetch("/remove_last_character", { method: "POST" })
      .then((response) => response.json())
      .then((data) => {
        // If the last character is a space, remove two characters
        if (data.recognized_characters.slice(-1) === " ") {
          data.recognized_characters = data.recognized_characters.slice(0, -2);
        }
        updateRecognizedCharacters();
      })
      .catch((error) => console.error("Error:", error));
  }

  function addSpace() {
    fetch("/add_space", { method: "POST" })
      .then(() => {
        messageDiv.style.display = "block";
        setTimeout(() => {
          messageDiv.style.display = "none";
        }, 1000);
      })
      .then(updateRecognizedCharacters)
      .catch((error) => console.error("Error:", error));
  }

  // Initial request to reset recognized characters
  fetch("/reset_recognized_characters", { method: "POST" })
    .then(updateRecognizedCharacters)
    .catch((error) => console.error("Error:", error));

  document
    .getElementById("delete_btn")
    .addEventListener("click", removeLastCharacter);
  document.getElementById("add_space_btn").addEventListener("click", addSpace);

  // Fetch and update characters every 1 second (adjust as needed)
  setInterval(updateRecognizedCharacters, 1000);

  function toggleCameraOn() {
    cameraActive = true;
    videoElement.style.display = "block";
    videoElement.src = "{{ url_for('home_blueprint.video_trans') }}"; // Set the src attribute
    labelElement.innerText = "Kamera Menyala";
  }
  window.addEventListener("load", function () {
    if (!cameraActive) {
      toggleCameraOn();
    }
  });
  var videoElement = document.getElementById("videoStream");
  var cameraActive = false;

  toggleSwitch.addEventListener("change", function () {
    cameraActive = !cameraActive;

    if (cameraActive) {
      videoElement.style.display = "block";
      videoElement.src = "{{ url_for('admin_blueprint.video') }}"; // Set the src attribute
      labelElement.innerText = "Kamera Menyala";
    } else {
      videoElement.style.display = "none";
      videoElement.src = "{{ url_for('admin_blueprint.tutup') }}"; // Reset the src attribute
      labelElement.innerText = "Kamera Mati";
    }
  });
</script>

{% endblock javascripts %}

<!-- function updateTranscript(newContent) {
  const transcriptDiv = document.getElementById("transcript_div");
  transcriptDiv.textContent = newContent;
}

const eventSource = new EventSource("/transcript_updates");

eventSource.onmessage = (event) => {
  const newTranscript = event.data;
  updateTranscript(newTranscript);
}; -->
